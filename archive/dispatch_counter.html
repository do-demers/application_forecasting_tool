<!DOCTYPE html>
<meta charset="utf-8">
<style>

.axis text {
  font: 10px sans-serif;
}

.axis line,
.axis path {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

#container {
  display: flex; /* or inline-flex */
  flex-direction: row 
}

h1 {
	font: 400 100px/500px "Helvetica Neue";
	text-align: center;
	width: 460px;
	height: 460px;
	margin: 0;
}
		
</style>
<body>
	
	<div id="chart">
	<p> Dispatch</p>
	<p>Range of applications you should expect</p>
	</div>
	

	<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore.js" type="text/javascript"></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="./temp_data_2.js"></script>
	<script>

		var dispatch = d3.dispatch("load", "statechange");

		var groups = ["Min","Avg","Max"];

		var states = d3.csvParse(temp_data, function(states,) {

			states.total = d3.sum(groups, function(k) { return states[k] = +states[k]; });
			return states;
			
		});
		

		var stateById = d3.map();

		_.map(states, function(d){ stateById.set(d.id, d); });
		
		
		// A drop-down menu for selecting a state; uses the "menu" namespace.
		dispatch.on("load.menu", function(stateById) {
		  var select = d3.select("body")
			.append("div")
			.append("select")
			  .on("change", function() { dispatch.call("statechange", this, stateById.get(this.value)); });

		
		  select.selectAll("option")
			  .data(stateById.values())
			.enter().append("option")
			  .attr("value", function(d) { return d.id; })
			  .text(function(d) { return d.id; });

		  dispatch.on("statechange.menu", function(state) {

			select.property("value", state.id);
			
		  });
		});

		// A bar chart to show total population; uses the "bar" namespace.
		dispatch.on("load.bar", function(stateById) {
		
		var margin = {top: 20, right: 20, bottom: 30, left: 40},
		width = 80 - margin.left - margin.right,
		height = 460 - margin.top - margin.bottom;

		var y = d3.scaleLinear()
			.domain([0, d3.max(stateById.values(), function(d) { return d.Max; })])
			.rangeRound([height, 0])
			.nice();

		var yAxis = d3.axisLeft(y)
			.tickFormat(d3.format(".2s"));

		var svg = d3.select("body")
			.append("div")
			.attr("id","container")
			.append("svg")
			.attr("width", width + margin.left + margin.right)
			.attr("height", height + margin.top + margin.bottom)
			.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

		svg.append("g")
			.attr("class", "y axis")
			.call(yAxis);

		var rect = svg.append("rect")
			.attr("x", 4)
			.attr("width", width - 4)
			.attr("y", height)
			.attr("height", 0)
			.style("fill", "#aaa");

		dispatch.on("statechange.bar", function(d) {

			rect.transition()
				.attr("y", y(d.Avg))
				.attr("height", y(0) - y(d.Avg));
			});
		});


	dispatch.on("load.numbers", function(stateById) {
	

		var numbers = d3
								.select("#container")
								.append("h1")
								.data(stateById.values())
								.text(function(d) { return "1" + " - " + "2"; });
		
		dispatch.on("statechange.numbers", function(d) {
	
			numbers
				.transition()
				.duration(2500)
				.tween("text", function() {
					var format = d3.format(".2");
					var that = d3.select(this);

					var temp = that
										.node()
										.innerHTML
										.match(/^\d+|\d+\b|\d+(?=\w)/g)
										.map(function (v) {return +v;}); 
		
					var i = d3.interpolateNumber(temp[0], d.Min);
					var j = d3.interpolateNumber(temp[1], d.Max);					


					return function(t) { that.text(format(i(t)) + " - " + format(j(t))); };
				});
		});
		
	});
		
		
		dispatch.call("load", this, stateById);
		dispatch.call("statechange", this, stateById.get("PM"));

	</script>
   </body>
</html>